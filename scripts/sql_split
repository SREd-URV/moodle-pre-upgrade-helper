#!/bin/bash
#
# Splits a mysql dump file into sql files for each table.
# Based on the script found here: http://kedar.nitty-witty.com/blog/mydumpsplitter-extract-tables-from-mysql-dump-shell-script
#
# Usage: sql_split <file.sql> <language(english|spanish)> <target>
#
# file - the dump generated by mysqldump
# language - language in which the dump was generated
# target - target directory for the new .sql files
#
# @author Robert Boloc <robertboloc@gmail.com>
# @copyright (c) 2013, Robert Boloc (http://robertboloc.eu)
# @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
#

# obtain configuration
language=${2:-'english'}; # default is english
target=${3:-'.'}; # default is the current directory(.)
string='';

# configure language & strings
if [ "$language" == "english" ]
then
	string='-- Table structure for table ';
elif [ "$language" == "spanish" ]
then
	string='-- Estructura de tabla para la tabla ';
elif [ "$language" == "catalan" ]
then
    string='-- Estructura de la taula ';
else
	echo 'Language not supported! Only english, catalan or spanish';
	exit 1;
fi

# split the dump
for table in $(grep "${string:3}" $1 | awk -F"\`" {'print $2'})
do
	echo 'Extracting '$table;
	sed -n "/^$string\`$table\`/,/^$string/p" $1 > $target/$table.sql;
done
